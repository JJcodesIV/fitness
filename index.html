<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitCompanion - Your Personal Fitness Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        primaryDark: '#4A49B0',
                        primaryLight: '#7F7EE6',
                    }
                }
            }
        }
    </script>
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(93, 92, 222, 0.5);
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .dark ::-webkit-scrollbar-thumb {
            background: rgba(93, 92, 222, 0.7);
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Exercise card hover effect */
        .exercise-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .exercise-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .dark .exercise-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-300">
    <!-- App Container -->
    <div class="container mx-auto px-4 pb-20 pt-4">
        <!-- Header -->
        <header class="mb-6">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl md:text-3xl font-bold text-primary dark:text-primaryLight">FitCompanion</h1>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Tabs -->
            <div class="tab-buttons flex border-b overflow-x-auto scrollbar-hide mb-4">
                <button class="tab-button px-4 py-2 font-medium border-b-2 border-primary dark:border-primaryLight" data-tab="home">Home</button>
                <button class="tab-button px-4 py-2 font-medium border-b-2 border-transparent opacity-70 hover:opacity-100" data-tab="workouts">Workouts</button>
                <button class="tab-button px-4 py-2 font-medium border-b-2 border-transparent opacity-70 hover:opacity-100" data-tab="diet">Diet</button>
                <button class="tab-button px-4 py-2 font-medium border-b-2 border-transparent opacity-70 hover:opacity-100" data-tab="trainer">AI Trainer</button>
                <button class="tab-button px-4 py-2 font-medium border-b-2 border-transparent opacity-70 hover:opacity-100" data-tab="profile">Profile</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active fade-in" id="home-tab">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Welcome Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold mb-4">Welcome to FitCompanion!</h2>
                        <p class="mb-4">Your personal fitness guide to help you achieve your health and fitness goals.</p>
                        <div id="profile-status" class="mb-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <p>Complete your profile to get personalized recommendations.</p>
                            <button id="setup-profile-btn" class="mt-2 bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                                Setup Profile
                            </button>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Quick Access</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="quick-access-btn bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-3 rounded-md text-left transition-colors" data-tab="workouts">
                                <span class="font-medium">Workouts</span>
                                <p class="text-sm opacity-75">Find or create workouts</p>
                            </button>
                            <button class="quick-access-btn bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-3 rounded-md text-left transition-colors" data-tab="diet">
                                <span class="font-medium">Diet Plans</span>
                                <p class="text-sm opacity-75">Plan your nutrition</p>
                            </button>
                            <button class="quick-access-btn bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-3 rounded-md text-left transition-colors" data-tab="trainer">
                                <span class="font-medium">AI Trainer</span>
                                <p class="text-sm opacity-75">Get personalized advice</p>
                            </button>
                            <button class="quick-access-btn bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-3 rounded-md text-left transition-colors" id="saved-workouts-btn">
                                <span class="font-medium">Saved Workouts</span>
                                <p class="text-sm opacity-75">View your custom plans</p>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Stats Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold mb-4">Your Progress</h2>
                        <div id="progress-placeholder" class="h-40 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <p class="text-gray-500 dark:text-gray-400">Complete your profile and log workouts to see your progress</p>
                        </div>
                        <div id="recent-activity" class="mt-4">
                            <h3 class="text-lg font-medium mb-2">Recent Activity</h3>
                            <div id="activity-placeholder" class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                <p class="text-gray-500 dark:text-gray-400">No recent activity. Start by creating a workout!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content fade-in" id="workouts-tab">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Workout Library</h2>
                        <button id="create-workout-btn" class="bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                            Create Workout
                        </button>
                    </div>
                    
                    <!-- Workout Filters -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <select id="workout-filter-type" class="bg-gray-100 dark:bg-gray-700 rounded-md px-3 py-2 text-base">
                            <option value="all">All Types</option>
                            <option value="strength">Strength</option>
                            <option value="cardio">Cardio</option>
                            <option value="hiit">HIIT</option>
                            <option value="flexibility">Flexibility</option>
                        </select>
                        <select id="workout-filter-level" class="bg-gray-100 dark:bg-gray-700 rounded-md px-3 py-2 text-base">
                            <option value="all">All Levels</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                        <select id="workout-filter-duration" class="bg-gray-100 dark:bg-gray-700 rounded-md px-3 py-2 text-base">
                            <option value="all">All Durations</option>
                            <option value="short">Short (< 30 min)</option>
                            <option value="medium">Medium (30-60 min)</option>
                            <option value="long">Long (> 60 min)</option>
                        </select>
                        <button id="workout-filter-reset" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 px-3 py-2 rounded-md transition-colors">
                            Reset
                        </button>
                    </div>

                    <!-- Workout Library -->
                    <div id="workout-library" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Workout cards will be generated here -->
                    </div>
                </div>

                <!-- Saved Workouts Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold mb-4">Your Saved Workouts</h2>
                    <div id="saved-workouts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Saved workout cards will be generated here -->
                        <div id="no-saved-workouts" class="col-span-full p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <p class="text-gray-500 dark:text-gray-400">No saved workouts yet. Create your first custom workout!</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content fade-in" id="diet-tab">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Diet Overview -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold mb-4">Nutrition Plans</h2>
                        <p class="mb-4">Get personalized nutrition advice based on your goals and preferences.</p>
                        
                        <div class="mb-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <h3 class="font-medium mb-2">Generate a Diet Plan</h3>
                            <form id="diet-form" class="space-y-4">
                                <div>
                                    <label class="block mb-1">Goal</label>
                                    <select id="diet-goal" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                        <option value="weight-loss">Weight Loss</option>
                                        <option value="muscle-gain">Muscle Gain</option>
                                        <option value="maintenance">Maintenance</option>
                                        <option value="performance">Athletic Performance</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1">Dietary Preferences</label>
                                    <select id="diet-preference" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                        <option value="none">No Restrictions</option>
                                        <option value="vegetarian">Vegetarian</option>
                                        <option value="vegan">Vegan</option>
                                        <option value="keto">Ketogenic</option>
                                        <option value="paleo">Paleo</option>
                                        <option value="mediterranean">Mediterranean</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1">Any Food Allergies or Restrictions?</label>
                                    <input type="text" id="diet-restrictions" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="e.g. gluten, dairy, nuts">
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                                    Generate Plan
                                </button>
                            </form>
                        </div>
                        
                        <h3 class="text-lg font-medium mb-2">Calorie Calculator</h3>
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <p class="mb-2">Calculate your daily calorie needs:</p>
                            <button id="calculate-calories-btn" class="bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors w-full">
                                Open Calculator
                            </button>
                        </div>
                    </div>
                    
                    <!-- Diet Plan Display -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold mb-4">Your Diet Plan</h2>
                        <div id="diet-plan-display" class="min-h-[400px]">
                            <div id="diet-plan-placeholder" class="h-full flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
                                <p class="text-gray-500 dark:text-gray-400">Generate a diet plan to see your personalized nutrition advice</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content fade-in" id="trainer-tab">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">AI Personal Trainer</h2>
                    <p class="mb-4">Ask questions about fitness, exercise form, nutrition, or get personalized advice.</p>
                    
                    <div id="trainer-chat" class="mb-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[300px] max-h-[500px] overflow-y-auto flex flex-col">
                        <div class="trainer-message bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm mb-3 self-start max-w-[80%]">
                            <p>👋 Hi! I'm your AI fitness trainer. How can I help you today?</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <input type="text" id="trainer-input" class="flex-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Ask a fitness question...">
                        <button id="trainer-send-btn" class="bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors whitespace-nowrap">
                            Send
                        </button>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-2">
                        <button class="quick-question bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-2 rounded-md text-sm transition-colors">
                            Recommend a workout for me
                        </button>
                        <button class="quick-question bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-2 rounded-md text-sm transition-colors">
                            How do I improve my squat form?
                        </button>
                        <button class="quick-question bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-2 rounded-md text-sm transition-colors">
                            Create a weekly plan
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold mb-4">Fitness Insights</h2>
                    <div id="insights-content" class="space-y-4">
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                            <p class="text-gray-500 dark:text-gray-400">Complete your profile to get personalized fitness insights.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content fade-in" id="profile-tab">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold mb-4">Your Profile</h2>
                    
                    <form id="profile-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-1">Name</label>
                                <input type="text" id="profile-name" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Your name">
                            </div>
                            <div>
                                <label class="block mb-1">Age</label>
                                <input type="number" id="profile-age" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Age" min="16" max="100">
                            </div>
                            <div>
                                <label class="block mb-1">Gender</label>
                                <select id="profile-gender" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                    <option value="">Select gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                    <option value="prefer-not-to-say">Prefer not to say</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-1">Weight (kg)</label>
                                <input type="number" id="profile-weight" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Weight in kg" min="30" max="300">
                            </div>
                            <div>
                                <label class="block mb-1">Height (cm)</label>
                                <input type="number" id="profile-height" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Height in cm" min="100" max="250">
                            </div>
                            <div>
                                <label class="block mb-1">Fitness Level</label>
                                <select id="profile-fitness-level" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                    <option value="">Select fitness level</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block mb-1">Primary Fitness Goal</label>
                            <select id="profile-goal" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="">Select goal</option>
                                <option value="lose-weight">Lose Weight</option>
                                <option value="build-muscle">Build Muscle</option>
                                <option value="increase-endurance">Increase Endurance</option>
                                <option value="improve-flexibility">Improve Flexibility</option>
                                <option value="general-fitness">General Fitness</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block mb-1">Available Equipment</label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="dumbbells">
                                    Dumbbells
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="barbell">
                                    Barbell
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="kettlebell">
                                    Kettlebell
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="resistance-bands">
                                    Resistance Bands
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="bench">
                                    Bench
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="pull-up-bar">
                                    Pull-up Bar
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="cardio-machine">
                                    Cardio Machine
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="gym-access">
                                    Full Gym Access
                                </label>
                                <label class="flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md">
                                    <input type="checkbox" class="equipment-checkbox mr-2" value="bodyweight">
                                    Bodyweight Only
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block mb-1">Workout Days per Week</label>
                            <select id="profile-workout-days" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="">Select days per week</option>
                                <option value="2">2 days</option>
                                <option value="3">3 days</option>
                                <option value="4">4 days</option>
                                <option value="5">5 days</option>
                                <option value="6">6 days</option>
                                <option value="7">7 days</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block mb-1">Preferred Workout Duration</label>
                            <select id="profile-workout-duration" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="">Select preferred duration</option>
                                <option value="short">Short (< 30 min)</option>
                                <option value="medium">Medium (30-60 min)</option>
                                <option value="long">Long (> 60 min)</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="w-full bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                            Save Profile
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Fixed Bottom Navigation (Mobile) -->
    <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg">
        <div class="flex justify-evenly">
            <button class="mobile-tab-button flex-1 flex flex-col items-center p-3 text-primary dark:text-primaryLight" data-tab="home">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span class="text-xs mt-1">Home</span>
            </button>
            <button class="mobile-tab-button flex-1 flex flex-col items-center p-3 opacity-70" data-tab="workouts">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
                <span class="text-xs mt-1">Workouts</span>
            </button>
            <button class="mobile-tab-button flex-1 flex flex-col items-center p-3 opacity-70" data-tab="diet">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                <span class="text-xs mt-1">Diet</span>
            </button>
            <button class="mobile-tab-button flex-1 flex flex-col items-center p-3 opacity-70" data-tab="trainer">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
                <span class="text-xs mt-1">Trainer</span>
            </button>
            <button class="mobile-tab-button flex-1 flex flex-col items-center p-3 opacity-70" data-tab="profile">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="text-xs mt-1">Profile</span>
            </button>
        </div>
    </nav>

    <!-- Modals -->
    <!-- Create Workout Modal -->
    <div id="create-workout-modal" class="hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Create Custom Workout</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <form id="create-workout-form" class="space-y-4">
                    <div>
                        <label class="block mb-1">Workout Name</label>
                        <input type="text" id="workout-name" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="e.g. Full Body Strength">
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-1">Type</label>
                            <select id="workout-type" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="strength">Strength</option>
                                <option value="cardio">Cardio</option>
                                <option value="hiit">HIIT</option>
                                <option value="flexibility">Flexibility</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1">Level</label>
                            <select id="workout-level" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block mb-1">Exercises</label>
                        <div id="exercise-list" class="space-y-2 mb-2">
                            <!-- Exercise inputs will be added here -->
                        </div>
                        <button type="button" id="add-exercise-btn" class="mt-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium px-4 py-2 rounded-md transition-colors">
                            Add Exercise
                        </button>
                    </div>
                    
                    <div>
                        <label class="block mb-1">Notes (optional)</label>
                        <textarea id="workout-notes" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Any additional instructions or notes" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                        Save Workout
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Workout Details Modal -->
    <div id="workout-details-modal" class="hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="details-workout-name" class="text-xl font-bold">Workout Name</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <div class="mb-4">
                    <div class="flex flex-wrap gap-2 mb-2">
                        <span id="details-workout-type" class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm"></span>
                        <span id="details-workout-level" class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm"></span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-medium mb-2">Exercises</h4>
                    <div id="details-exercise-list" class="space-y-2">
                        <!-- Exercise details will be added here -->
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-medium mb-2">Notes</h4>
                    <div id="details-workout-notes" class="p-3 bg-gray-100 dark:bg-gray-700 rounded-md">
                        <!-- Notes will be added here -->
                    </div>
                </div>
                
                <div class="flex gap-2 mt-4">
                    <button id="start-workout-btn" class="flex-1 bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                        Start Workout
                    </button>
                    <button id="delete-workout-btn" class="bg-red-500 hover:bg-red-600 text-white font-medium px-4 py-2 rounded-md transition-colors">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calorie Calculator Modal -->
    <div id="calorie-calculator-modal" class="hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Calorie Calculator</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <form id="calorie-calculator-form" class="space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-1">Age</label>
                            <input type="number" id="calorie-age" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Age" min="16" max="100">
                        </div>
                        <div>
                            <label class="block mb-1">Gender</label>
                            <select id="calorie-gender" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-1">Weight (kg)</label>
                            <input type="number" id="calorie-weight" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Weight in kg" min="30" max="300">
                        </div>
                        <div>
                            <label class="block mb-1">Height (cm)</label>
                            <input type="number" id="calorie-height" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Height in cm" min="100" max="250">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block mb-1">Activity Level</label>
                        <select id="calorie-activity" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                            <option value="sedentary">Sedentary (little or no exercise)</option>
                            <option value="light">Lightly active (light exercise 1-3 days/week)</option>
                            <option value="moderate">Moderately active (moderate exercise 3-5 days/week)</option>
                            <option value="active">Active (hard exercise 6-7 days/week)</option>
                            <option value="very-active">Very active (very hard exercise & physical job)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block mb-1">Goal</label>
                        <select id="calorie-goal" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base">
                            <option value="lose">Lose weight</option>
                            <option value="maintain">Maintain weight</option>
                            <option value="gain">Gain weight</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                        Calculate
                    </button>
                </form>
                
                <div id="calorie-results" class="mt-4 hidden">
                    <h4 class="font-medium mb-2">Your Results</h4>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <div class="mb-2">
                            <span class="font-medium">BMR (Basal Metabolic Rate):</span>
                            <span id="result-bmr" class="float-right"></span>
                        </div>
                        <div class="mb-2">
                            <span class="font-medium">Maintenance Calories:</span>
                            <span id="result-maintenance" class="float-right"></span>
                        </div>
                        <div class="mb-2">
                            <span class="font-medium">Recommended Daily Calories:</span>
                            <span id="result-recommended" class="float-right font-bold text-primary"></span>
                        </div>
                        <div class="mt-4 text-sm">
                            <p class="mb-1">Recommended Macronutrient Split:</p>
                            <div class="grid grid-cols-3 gap-2 text-center">
                                <div class="p-2 bg-primary bg-opacity-10 dark:bg-opacity-20 rounded">
                                    <div class="font-medium">Protein</div>
                                    <div id="result-protein" class="mt-1"></div>
                                </div>
                                <div class="p-2 bg-primary bg-opacity-10 dark:bg-opacity-20 rounded">
                                    <div class="font-medium">Carbs</div>
                                    <div id="result-carbs" class="mt-1"></div>
                                </div>
                                <div class="p-2 bg-primary bg-opacity-10 dark:bg-opacity-20 rounded">
                                    <div class="font-medium">Fat</div>
                                    <div id="result-fat" class="mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Workout Modal -->
    <div id="active-workout-modal" class="hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="active-workout-name" class="text-xl font-bold">Workout Name</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <div class="mb-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-center">
                    <div id="workout-timer" class="text-3xl font-bold">00:00</div>
                    <div class="flex justify-center gap-2 mt-2">
                        <button id="timer-start-btn" class="bg-primary hover:bg-primaryDark text-white font-medium px-4 py-1 rounded-md transition-colors">
                            Start
                        </button>
                        <button id="timer-pause-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium px-4 py-1 rounded-md transition-colors hidden">
                            Pause
                        </button>
                        <button id="timer-reset-btn" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 font-medium px-4 py-1 rounded-md transition-colors">
                            Reset
                        </button>
                    </div>
                </div>
                
                <div id="active-exercises" class="space-y-4">
                    <!-- Active exercise cards will be added here -->
                </div>
                
                <button id="complete-workout-btn" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-md transition-colors">
                    Complete Workout
                </button>
            </div>
        </div>
    </div>

    <script>
        // Helper functions
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);
        
        // Dark mode detection and toggle
        function initDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
            
            $('#theme-toggle').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
            });
        }
        
        // Tab navigation
        function initTabs() {
            const tabButtons = $$('.tab-button');
            const mobileTabButtons = $$('.mobile-tab-button');
            const quickAccessButtons = $$('.quick-access-btn');
            
            function switchTab(tabId) {
                // Update active tab button
                tabButtons.forEach(btn => {
                    if (btn.dataset.tab === tabId) {
                        btn.classList.add('border-primary', 'dark:border-primaryLight');
                        btn.classList.remove('border-transparent', 'opacity-70');
                    } else {
                        btn.classList.remove('border-primary', 'dark:border-primaryLight');
                        btn.classList.add('border-transparent', 'opacity-70');
                    }
                });
                
                // Update active mobile tab button
                mobileTabButtons.forEach(btn => {
                    if (btn.dataset.tab === tabId) {
                        btn.classList.add('text-primary', 'dark:text-primaryLight');
                        btn.classList.remove('opacity-70');
                    } else {
                        btn.classList.remove('text-primary', 'dark:text-primaryLight');
                        btn.classList.add('opacity-70');
                    }
                });
                
                // Show active tab content
                $$('.tab-content').forEach(content => {
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }
            
            // Tab button click handlers
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.dataset.tab);
                });
            });
            
            // Mobile tab button click handlers
            mobileTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.dataset.tab);
                });
            });
            
            // Quick access button click handlers
            quickAccessButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (button.dataset.tab) {
                        switchTab(button.dataset.tab);
                    }
                });
            });
            
            // Setup profile button
            $('#setup-profile-btn').addEventListener('click', () => {
                switchTab('profile');
            });
            
            // Saved workouts button
            $('#saved-workouts-btn').addEventListener('click', () => {
                switchTab('workouts');
            });
        }
        
        // Modal functions
        function initModals() {
            const modals = [
                '#create-workout-modal',
                '#workout-details-modal',
                '#calorie-calculator-modal',
                '#active-workout-modal'
            ];
            
            // Close modal when clicking close button
            $$('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    const modal = btn.closest('[id$="-modal"]');
                    if (modal) modal.classList.add('hidden');
                });
            });
            
            // Close modal when clicking outside
            modals.forEach(modalId => {
                const modal = $(modalId);
                modal.addEventListener('click', e => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
            
            // Open create workout modal
            $('#create-workout-btn').addEventListener('click', () => {
                $('#create-workout-modal').classList.remove('hidden');
            });
            
            // Open calorie calculator modal
            $('#calculate-calories-btn').addEventListener('click', () => {
                // Pre-fill with profile data if available
                const profileData = loadUserProfile();
                if (profileData) {
                    $('#calorie-age').value = profileData.age || '';
                    $('#calorie-gender').value = profileData.gender || 'male';
                    $('#calorie-weight').value = profileData.weight || '';
                    $('#calorie-height').value = profileData.height || '';
                }
                
                $('#calorie-calculator-modal').classList.remove('hidden');
            });
        }
        
        // Local storage functions
        function saveUserProfile(profileData) {
            localStorage.setItem('fitCompanion_userProfile', JSON.stringify(profileData));
        }
        
        function loadUserProfile() {
            const profile = localStorage.getItem('fitCompanion_userProfile');
            return profile ? JSON.parse(profile) : null;
        }
        
        function saveWorkout(workout) {
            const savedWorkouts = getSavedWorkouts();
            workout.id = Date.now().toString(); // Add unique ID
            savedWorkouts.push(workout);
            localStorage.setItem('fitCompanion_savedWorkouts', JSON.stringify(savedWorkouts));
        }
        
        function getSavedWorkouts() {
            const workouts = localStorage.getItem('fitCompanion_savedWorkouts');
            return workouts ? JSON.parse(workouts) : [];
        }
        
        function deleteWorkout(workoutId) {
            const savedWorkouts = getSavedWorkouts();
            const updatedWorkouts = savedWorkouts.filter(workout => workout.id !== workoutId);
            localStorage.setItem('fitCompanion_savedWorkouts', JSON.stringify(updatedWorkouts));
        }
        
        // Load user profile and update UI
        function initUserProfile() {
            const profileForm = $('#profile-form');
            const profileData = loadUserProfile();
            
            if (profileData) {
                // Fill form with saved data
                $('#profile-name').value = profileData.name || '';
                $('#profile-age').value = profileData.age || '';
                $('#profile-gender').value = profileData.gender || '';
                $('#profile-weight').value = profileData.weight || '';
                $('#profile-height').value = profileData.height || '';
                $('#profile-fitness-level').value = profileData.fitnessLevel || '';
                $('#profile-goal').value = profileData.goal || '';
                $('#profile-workout-days').value = profileData.workoutDays || '';
                $('#profile-workout-duration').value = profileData.workoutDuration || '';
                
                // Check equipment boxes
                if (profileData.equipment && Array.isArray(profileData.equipment)) {
                    $$('.equipment-checkbox').forEach(checkbox => {
                        if (profileData.equipment.includes(checkbox.value)) {
                            checkbox.checked = true;
                        }
                    });
                }
                
                // Update home screen with profile info
                $('#profile-status').innerHTML = `
                    <p class="mb-1">Welcome back, ${profileData.name}!</p>
                    <p class="text-sm">Goal: ${formatGoal(profileData.goal)}</p>
                `;
            }
            
            // Profile form submission
            profileForm.addEventListener('submit', e => {
                e.preventDefault();
                
                const equipment = Array.from($$('.equipment-checkbox:checked')).map(cb => cb.value);
                
                const profileData = {
                    name: $('#profile-name').value,
                    age: $('#profile-age').value,
                    gender: $('#profile-gender').value,
                    weight: $('#profile-weight').value,
                    height: $('#profile-height').value,
                    fitnessLevel: $('#profile-fitness-level').value,
                    goal: $('#profile-goal').value,
                    equipment: equipment,
                    workoutDays: $('#profile-workout-days').value,
                    workoutDuration: $('#profile-workout-duration').value
                };
                
                saveUserProfile(profileData);
                
                // Update home screen
                $('#profile-status').innerHTML = `
                    <p class="mb-1">Welcome back, ${profileData.name}!</p>
                    <p class="text-sm">Goal: ${formatGoal(profileData.goal)}</p>
                `;
                
                // Show success message
                alert('Profile saved successfully!');
            });
        }
        
        // Format goal text for display
        function formatGoal(goalValue) {
            const goals = {
                'lose-weight': 'Lose Weight',
                'build-muscle': 'Build Muscle',
                'increase-endurance': 'Increase Endurance',
                'improve-flexibility': 'Improve Flexibility',
                'general-fitness': 'General Fitness'
            };
            
            return goals[goalValue] || 'Not specified';
        }
        
        // Initialize workout library
        function initWorkoutLibrary() {
            const workoutLibrary = [
                {
                    id: 'default-1',
                    name: 'Full Body Strength',
                    type: 'strength',
                    level: 'beginner',
                    duration: 'medium',
                    exercises: [
                        { name: 'Push-ups', sets: 3, reps: '10-12', rest: '60 sec' },
                        { name: 'Squats', sets: 3, reps: '12-15', rest: '60 sec' },
                        { name: 'Dumbbell Rows', sets: 3, reps: '10-12 per arm', rest: '60 sec' },
                        { name: 'Lunges', sets: 3, reps: '10 per leg', rest: '60 sec' },
                        { name: 'Plank', sets: 3, reps: '30-45 sec hold', rest: '45 sec' }
                    ],
                    notes: 'Warm up with 5 minutes of light cardio. Focus on proper form rather than speed.'
                },
                {
                    id: 'default-2',
                    name: 'HIIT Cardio Blast',
                    type: 'hiit',
                    level: 'intermediate',
                    duration: 'short',
                    exercises: [
                        { name: 'Jumping Jacks', sets: 1, reps: '45 sec work / 15 sec rest' },
                        { name: 'Mountain Climbers', sets: 1, reps: '45 sec work / 15 sec rest' },
                        { name: 'Burpees', sets: 1, reps: '45 sec work / 15 sec rest' },
                        { name: 'High Knees', sets: 1, reps: '45 sec work / 15 sec rest' },
                        { name: 'Squat Jumps', sets: 1, reps: '45 sec work / 15 sec rest' }
                    ],
                    notes: 'Repeat the circuit 3-4 times with 1 minute rest between rounds.'
                },
                {
                    id: 'default-3',
                    name: 'Flexibility & Mobility',
                    type: 'flexibility',
                    level: 'beginner',
                    duration: 'short',
                    exercises: [
                        { name: 'Cat-Cow Stretch', sets: 1, reps: '10 slow reps' },
                        { name: 'Child\'s Pose', sets: 1, reps: '30 sec hold' },
                        { name: 'Downward Dog', sets: 1, reps: '30 sec hold' },
                        { name: 'Hip Flexor Stretch', sets: 1, reps: '30 sec per side' },
                        { name: 'Hamstring Stretch', sets: 1, reps: '30 sec per side' },
                        { name: 'Shoulder Rolls', sets: 1, reps: '10 forward, 10 backward' }
                    ],
                    notes: 'Move gently into each stretch, never forcing or bouncing. Breathe deeply throughout.'
                },
                {
                    id: 'default-4',
                    name: 'Upper Body Focus',
                    type: 'strength',
                    level: 'intermediate',
                    duration: 'medium',
                    exercises: [
                        { name: 'Bench Press or Push-ups', sets: 4, reps: '8-10', rest: '90 sec' },
                        { name: 'Bent-Over Rows', sets: 4, reps: '10-12', rest: '90 sec' },
                        { name: 'Shoulder Press', sets: 3, reps: '10-12', rest: '60 sec' },
                        { name: 'Pull-ups or Lat Pulldowns', sets: 3, reps: '8-10', rest: '60 sec' },
                        { name: 'Tricep Dips', sets: 3, reps: '12-15', rest: '60 sec' },
                        { name: 'Bicep Curls', sets: 3, reps: '12-15', rest: '60 sec' }
                    ],
                    notes: 'Start with a proper warm-up of the shoulders, chest, and back.'
                },
                {
                    id: 'default-5',
                    name: 'Lower Body Power',
                    type: 'strength',
                    level: 'advanced',
                    duration: 'medium',
                    exercises: [
                        { name: 'Barbell Squats', sets: 5, reps: '5-8', rest: '2 min' },
                        { name: 'Romanian Deadlifts', sets: 4, reps: '8-10', rest: '90 sec' },
                        { name: 'Walking Lunges', sets: 3, reps: '12 steps per leg', rest: '90 sec' },
                        { name: 'Leg Press', sets: 3, reps: '10-12', rest: '90 sec' },
                        { name: 'Calf Raises', sets: 4, reps: '15-20', rest: '60 sec' },
                        { name: 'Glute Bridges', sets: 3, reps: '15-20', rest: '60 sec' }
                    ],
                    notes: 'Ensure proper form on squats and deadlifts. Use appropriate weight.'
                },
                {
                    id: 'default-6',
                    name: '30-Minute Cardio',
                    type: 'cardio',
                    level: 'beginner',
                    duration: 'medium',
                    exercises: [
                        { name: 'Brisk Walking', sets: 1, reps: '5 min' },
                        { name: 'Light Jogging', sets: 1, reps: '5 min' },
                        { name: 'Moderate Pace Run/Walk', sets: 1, reps: '10 min' },
                        { name: 'Fast Walking Uphill', sets: 1, reps: '5 min' },
                        { name: 'Cool Down Walk', sets: 1, reps: '5 min' }
                    ],
                    notes: 'Adjust intensity based on your fitness level. Can be done on treadmill, outdoors, or any cardio machine.'
                }
            ];
            
            // Display workout library
            displayWorkoutLibrary(workoutLibrary);
            
            // Initialize workout filter
            initWorkoutFilters(workoutLibrary);
            
            // Display saved workouts
            displaySavedWorkouts();
            
            // Create workout form
            initCreateWorkoutForm();
            
            // Workout details
            initWorkoutDetails(workoutLibrary);
        }
        
        // Display workout library
        function displayWorkoutLibrary(workouts) {
            const workoutLibraryEl = $('#workout-library');
            workoutLibraryEl.innerHTML = '';
            
            workouts.forEach(workout => {
                const workoutCard = document.createElement('div');
                workoutCard.className = 'exercise-card bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border border-gray-200 dark:border-gray-700';
                workoutCard.dataset.workoutId = workout.id;
                workoutCard.dataset.workoutType = workout.type;
                workoutCard.dataset.workoutLevel = workout.level;
                workoutCard.dataset.workoutDuration = workout.duration || 'medium';
                
                workoutCard.innerHTML = `
                    <h3 class="font-bold text-lg mb-2">${workout.name}</h3>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <span class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm">${capitalizeFirst(workout.type)}</span>
                        <span class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm">${capitalizeFirst(workout.level)}</span>
                    </div>
                    <p class="text-sm mb-2">${workout.exercises.length} exercises</p>
                    <button class="view-workout-btn w-full mt-2 bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                        View Details
                    </button>
                `;
                
                workoutLibraryEl.appendChild(workoutCard);
            });
            
            // Add event listeners to view buttons
            $$('.view-workout-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const workoutCard = btn.closest('[data-workout-id]');
                    const workoutId = workoutCard.dataset.workoutId;
                    const workout = workouts.find(w => w.id === workoutId) || 
                                    getSavedWorkouts().find(w => w.id === workoutId);
                    
                    if (workout) {
                        openWorkoutDetails(workout);
                    }
                });
            });
        }
        
        // Display saved workouts
        function displaySavedWorkouts() {
            const savedWorkoutsEl = $('#saved-workouts');
            const savedWorkouts = getSavedWorkouts();
            
            // Show or hide placeholder
            $('#no-saved-workouts').style.display = savedWorkouts.length > 0 ? 'none' : 'block';
            
            // Clear previous saved workouts (except placeholder)
            Array.from(savedWorkoutsEl.children).forEach(child => {
                if (child.id !== 'no-saved-workouts') {
                    savedWorkoutsEl.removeChild(child);
                }
            });
            
            // Add saved workouts
            savedWorkouts.forEach(workout => {
                const workoutCard = document.createElement('div');
                workoutCard.className = 'exercise-card bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border border-gray-200 dark:border-gray-700';
                workoutCard.dataset.workoutId = workout.id;
                workoutCard.dataset.workoutType = workout.type;
                workoutCard.dataset.workoutLevel = workout.level;
                
                workoutCard.innerHTML = `
                    <h3 class="font-bold text-lg mb-2">${workout.name}</h3>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <span class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm">${capitalizeFirst(workout.type)}</span>
                        <span class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-sm">${capitalizeFirst(workout.level)}</span>
                    </div>
                    <p class="text-sm mb-2">${workout.exercises.length} exercises</p>
                    <button class="view-workout-btn w-full mt-2 bg-primary hover:bg-primaryDark text-white font-medium px-4 py-2 rounded-md transition-colors">
                        View Details
                    </button>
                `;
                
                savedWorkoutsEl.appendChild(workoutCard);
            });
            
            // Add event listeners to view buttons
            $$('#saved-workouts .view-workout-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const workoutCard = btn.closest('[data-workout-id]');
                    const workoutId = workoutCard.dataset.workoutId;
                    const workout = getSavedWorkouts().find(w => w.id === workoutId);
                    
                    if (workout) {
                        openWorkoutDetails(workout);
                    }
                });
            });
        }
        
        // Initialize workout filters
        function initWorkoutFilters(workoutLibrary) {
            const filterType = $('#workout-filter-type');
            const filterLevel = $('#workout-filter-level');
            const filterDuration = $('#workout-filter-duration');
            const resetButton = $('#workout-filter-reset');
            
            function applyFilters() {
                const typeFilter = filterType.value;
                const levelFilter = filterLevel.value;
                const durationFilter = filterDuration.value;
                
                const filteredWorkouts = workoutLibrary.filter(workout => {
                    return (typeFilter === 'all' || workout.type === typeFilter) &&
                           (levelFilter === 'all' || workout.level === levelFilter) &&
                           (durationFilter === 'all' || workout.duration === durationFilter);
                });
                
                displayWorkoutLibrary(filteredWorkouts);
            }
            
            filterType.addEventListener('change', applyFilters);
            filterLevel.addEventListener('change', applyFilters);
            filterDuration.addEventListener('change', applyFilters);
            
            resetButton.addEventListener('click', () => {
                filterType.value = 'all';
                filterLevel.value = 'all';
                filterDuration.value = 'all';
                displayWorkoutLibrary(workoutLibrary);
            });
        }
        
        // Initialize create workout form
        function initCreateWorkoutForm() {
            const createForm = $('#create-workout-form');
            const exerciseList = $('#exercise-list');
            const addExerciseBtn = $('#add-exercise-btn');
            
            // Add initial exercise row
            addExerciseRow();
            
            // Add exercise button
            addExerciseBtn.addEventListener('click', () => {
                addExerciseRow();
            });
            
            // Form submission
            createForm.addEventListener('submit', e => {
                e.preventDefault();
                
                // Collect exercise data
                const exercises = [];
                const exerciseRows = $$('#exercise-list .exercise-row');
                
                exerciseRows.forEach(row => {
                    const name = row.querySelector('.exercise-name').value;
                    const sets = row.querySelector('.exercise-sets').value;
                    const reps = row.querySelector('.exercise-reps').value;
                    const rest = row.querySelector('.exercise-rest').value;
                    
                    if (name) {
                        exercises.push({
                            name: name,
                            sets: parseInt(sets) || 1,
                            reps: reps,
                            rest: rest
                        });
                    }
                });
                
                // Create workout object
                const workout = {
                    name: $('#workout-name').value,
                    type: $('#workout-type').value,
                    level: $('#workout-level').value,
                    exercises: exercises,
                    notes: $('#workout-notes').value
                };
                
                // Save workout
                saveWorkout(workout);
                
                // Reset form
                createForm.reset();
                exerciseList.innerHTML = '';
                addExerciseRow();
                
                // Close modal
                $('#create-workout-modal').classList.add('hidden');
                
                // Refresh saved workouts display
                displaySavedWorkouts();
            });
            
            // Function to add a new exercise row
            function addExerciseRow() {
                const row = document.createElement('div');
                row.className = 'exercise-row grid grid-cols-2 sm:grid-cols-4 gap-2 items-center';
                
                row.innerHTML = `
                    <input type="text" class="exercise-name col-span-2 sm:col-span-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Exercise Name">
                    <input type="number" class="exercise-sets bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Sets" min="1" max="10" value="3">
                    <input type="text" class="exercise-reps bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Reps" value="10-12">
                    <input type="text" class="exercise-rest col-span-1 sm:col-span-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-base" placeholder="Rest" value="60 sec">
                    <button type="button" class="remove-exercise-btn text-red-500 hover:text-red-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                
                exerciseList.appendChild(row);
                
                // Add event listener to remove button
                row.querySelector('.remove-exercise-btn').addEventListener('click', () => {
                    exerciseList.removeChild(row);
                });
            }
        }
        
        // Initialize workout details modal
        function initWorkoutDetails(workoutLibrary) {
            const deleteWorkoutBtn = $('#delete-workout-btn');
            const startWorkoutBtn = $('#start-workout-btn');
            
            // Delete workout button
            deleteWorkoutBtn.addEventListener('click', () => {
                const workoutId = $('#workout-details-modal').dataset.workoutId;
                
                // Only allow deleting custom workouts
                if (workoutId && !workoutId.startsWith('default')) {
                    deleteWorkout(workoutId);
                    displaySavedWorkouts();
                    $('#workout-details-modal').classList.add('hidden');
                }
            });
            
            // Start workout button
            startWorkoutBtn.addEventListener('click', () => {
                const workoutId = $('#workout-details-modal').dataset.workoutId;
                const workout = workoutLibrary.find(w => w.id === workoutId) || 
                                getSavedWorkouts().find(w => w.id === workoutId);
                
                if (workout) {
                    startWorkout(workout);
                    $('#workout-details-modal').classList.add('hidden');
                }
            });
        }
        
        // Open workout details modal
        function openWorkoutDetails(workout) {
            const modal = $('#workout-details-modal');
            const detailsName = $('#details-workout-name');
            const detailsType = $('#details-workout-type');
            const detailsLevel = $('#details-workout-level');
            const detailsExerciseList = $('#details-exercise-list');
            const detailsNotes = $('#details-workout-notes');
            const deleteButton = $('#delete-workout-btn');
            
            // Set modal data
            modal.dataset.workoutId = workout.id;
            detailsName.textContent = workout.name;
            detailsType.textContent = capitalizeFirst(workout.type);
            detailsLevel.textContent = capitalizeFirst(workout.level);
            
            // Show or hide delete button (only for custom workouts)
            deleteButton.style.display = workout.id.startsWith('default') ? 'none' : 'block';
            
            // Fill exercise list
            detailsExerciseList.innerHTML = '';
            workout.exercises.forEach((exercise, index) => {
                const exerciseItem = document.createElement('div');
                exerciseItem.className = 'p-3 bg-gray-100 dark:bg-gray-700 rounded-md';
                
                exerciseItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-medium">${index + 1}. ${exercise.name}</span>
                    </div>
                    <div class="text-sm mt-1">
                        <span>${exercise.sets} sets × ${exercise.reps}</span>
                        ${exercise.rest ? `<span class="ml-2">• Rest: ${exercise.rest}</span>` : ''}
                    </div>
                `;
                
                detailsExerciseList.appendChild(exerciseItem);
            });
            
            // Set notes
            detailsNotes.textContent = workout.notes || 'No additional notes.';
            
            // Show modal
            modal.classList.remove('hidden');
        }
        
        // Start workout
        function startWorkout(workout) {
            const activeWorkoutModal = $('#active-workout-modal');
            const activeWorkoutName = $('#active-workout-name');
            const activeExercises = $('#active-exercises');
            
            // Set workout name
            activeWorkoutName.textContent = workout.name;
            
            // Clear previous exercises
            activeExercises.innerHTML = '';
            
            // Add exercise cards
            workout.exercises.forEach((exercise, index) => {
                const exerciseCard = document.createElement('div');
                exerciseCard.className = 'exercise-card bg-white dark:bg-gray-800 shadow-sm rounded-lg p-4 border border-gray-200 dark:border-gray-700';
                
                exerciseCard.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-medium">${exercise.name}</h4>
                        <span class="bg-primary bg-opacity-10 text-primary dark:bg-opacity-20 px-2 py-1 rounded-md text-xs">${index + 1}/${workout.exercises.length}</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center mb-2">
                        <div class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Sets</span>
                            <div class="font-medium">${exercise.sets}</div>
                        </div>
                        <div class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Reps</span>
                            <div class="font-medium">${exercise.reps}</div>
                        </div>
                        <div class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Rest</span>
                            <div class="font-medium">${exercise.rest || 'N/A'}</div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="flex-1 grid grid-cols-${exercise.sets} gap-1">
                            ${Array(exercise.sets).fill().map(() => 
                                `<button class="set-complete-btn p-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 m-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                </button>`
                            ).join('')}
                        </div>
                    </div>
                `;
                
                activeExercises.appendChild(exerciseCard);
            });
            
            // Add click handlers for set completion buttons
            $$('.set-complete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('bg-green-500');
                    btn.classList.toggle('hover:bg-green-600');
                    btn.classList.toggle('text-white');
                    btn.classList.toggle('bg-gray-200');
                    btn.classList.toggle('hover:bg-gray-300');
                    btn.classList.toggle('dark:bg-gray-700');
                    btn.classList.toggle('dark:hover:bg-gray-600');
                });
            });
            
            // Initialize workout timer
            initWorkoutTimer();
            
            // Complete workout button
            $('#complete-workout-btn').addEventListener('click', () => {
                // Save workout to activity log
                const activityLog = JSON.parse(localStorage.getItem('fitCompanion_activityLog') || '[]');
                activityLog.push({
                    date: new Date().toISOString(),
                    workoutId: workout.id,
                    workoutName: workout.name,
                    duration: $('#workout-timer').textContent
                });
                localStorage.setItem('fitCompanion_activityLog', JSON.stringify(activityLog));
                
                // Close modal
                activeWorkoutModal.classList.add('hidden');
                
                // Update recent activity on home screen
                updateRecentActivity();
            });
            
            // Show modal
            activeWorkoutModal.classList.remove('hidden');
        }
        
        // Initialize workout timer
        function initWorkoutTimer() {
            const timerDisplay = $('#workout-timer');
            const startBtn = $('#timer-start-btn');
            const pauseBtn = $('#timer-pause-btn');
            const resetBtn = $('#timer-reset-btn');
            
            let startTime;
            let elapsedTime = 0;
            let timerInterval;
            
            // Reset timer
            timerDisplay.textContent = '00:00';
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            
            // Start timer
            startBtn.addEventListener('click', () => {
                startTime = Date.now() - elapsedTime;
                timerInterval = setInterval(updateTimer, 1000);
                
                startBtn.classList.add('hidden');
                pauseBtn.classList.remove('hidden');
            });
            
            // Pause timer
            pauseBtn.addEventListener('click', () => {
                clearInterval(timerInterval);
                elapsedTime = Date.now() - startTime;
                
                pauseBtn.classList.add('hidden');
                startBtn.classList.remove('hidden');
            });
            
            // Reset timer
            resetBtn.addEventListener('click', () => {
                clearInterval(timerInterval);
                timerDisplay.textContent = '00:00';
                elapsedTime = 0;
                
                pauseBtn.classList.add('hidden');
                startBtn.classList.remove('hidden');
            });
            
            // Update timer display
            function updateTimer() {
                const currentTime = Date.now();
                elapsedTime = currentTime - startTime;
                
                const seconds = Math.floor(elapsedTime / 1000) % 60;
                const minutes = Math.floor(elapsedTime / 1000 / 60);
                
                timerDisplay.textContent = `${padZero(minutes)}:${padZero(seconds)}`;
            }
            
            // Helper to pad with zero
            function padZero(num) {
                return num.toString().padStart(2, '0');
            }
        }
        
        // Update recent activity on home screen
        function updateRecentActivity() {
            const activityLog = JSON.parse(localStorage.getItem('fitCompanion_activityLog') || '[]');
            const activityContainer = $('#activity-placeholder');
            
            if (activityLog.length > 0) {
                // Sort by date (newest first)
                activityLog.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Take most recent 3 activities
                const recentActivities = activityLog.slice(0, 3);
                
                activityContainer.innerHTML = '';
                
                recentActivities.forEach(activity => {
                    const date = new Date(activity.date);
                    const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                    
                    const activityItem = document.createElement('div');
                    activityItem.className = 'mb-2 p-2 bg-white dark:bg-gray-800 rounded-md shadow-sm';
                    
                    activityItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="font-medium">${activity.workoutName}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${activity.duration}</span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">${formattedDate}</div>
                    `;
                    
                    activityContainer.appendChild(activityItem);
                });
            }
        }
        
        // Initialize diet form
        function initDietForm() {
            const dietForm = $('#diet-form');
            
            dietForm.addEventListener('submit', async e => {
                e.preventDefault();
                
                const goal = $('#diet-goal').value;
                const preference = $('#diet-preference').value;
                const restrictions = $('#diet-restrictions').value;
                
                // Get user profile data
                const profile = loadUserProfile() || {};
                
                // Show loading state
                $('#diet-plan-placeholder').innerHTML = `
                    <div class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mb-2"></div>
                        <p>Generating your personalized diet plan...</p>
                    </div>
                `;
                $('#diet-plan-placeholder').style.display = 'block';
                
                try {
                    // Prepare the data to send to the AI
                    const promptData = {
                        goal: goal,
                        preference: preference,
                        restrictions: restrictions || 'None',
                        age: profile.age || 'Not specified',
                        gender: profile.gender || 'Not specified',
                        weight: profile.weight || 'Not specified',
                        height: profile.height || 'Not specified',
                        activityLevel: profile.fitnessLevel || 'Not specified',
                        workoutDays: profile.workoutDays || 'Not specified'
                    };
                    
                    // Get diet plan from Claude
                    const dietPlanDiv = $('#diet-plan-display');
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'markdown-content';
                    dietPlanDiv.innerHTML = '';
                    dietPlanDiv.appendChild(resultDiv);
                    
                    // Register a handler for the response
                    window.Poe.registerHandler("diet-plan-handler", (result, context) => {
                        const msg = result.responses[0];
                        
                        if (msg.status === "error") {
                            resultDiv.innerHTML = `<p class="text-red-500">Error generating diet plan: ${msg.statusText || 'Unknown error'}</p>`;
                        } else if (msg.status === "incomplete") {
                            // Update with partial content while streaming
                            resultDiv.innerHTML = marked.parse(msg.content);
                        } else if (msg.status === "complete") {
                            // Update with final content
                            resultDiv.innerHTML = marked.parse(msg.content);
                            // Hide the placeholder
                            $('#diet-plan-placeholder').style.display = 'none';
                        }
                    });
                    
                    // Build the prompt
                    const prompt = `@Claude-3.7-Sonnet Create a personalized diet plan based on the following user information:

Goal: ${promptData.goal.replace(/-/g, ' ')}
Dietary Preference: ${promptData.preference.replace(/-/g, ' ')}
Restrictions: ${promptData.restrictions}
Age: ${promptData.age}
Gender: ${promptData.gender}
Weight: ${promptData.weight} kg
Height: ${promptData.height} cm
Activity Level: ${promptData.activityLevel}
Workout Days per Week: ${promptData.workoutDays}

Provide a well-structured diet plan including:
1. Daily calorie target
2. Macronutrient breakdown (protein, carbs, fat)
3. Sample meal plan for one day
4. Food recommendations
5. Tips for adherence

Format your response with Markdown for better readability.`;
                    
                    // Send the prompt to Claude
                    await window.Poe.sendUserMessage(prompt, {
                        handler: "diet-plan-handler",
                        stream: true,
                        openChat: false
                    });
                    
                } catch (error) {
                    $('#diet-plan-placeholder').innerHTML = `
                        <p class="text-red-500">Error generating diet plan: ${error.message || 'Unknown error'}</p>
                    `;
                }
            });
        }
        
        // Initialize calorie calculator
        function initCalorieCalculator() {
            const calorieForm = $('#calorie-calculator-form');
            
            calorieForm.addEventListener('submit', e => {
                e.preventDefault();
                
                const age = parseInt($('#calorie-age').value);
                const gender = $('#calorie-gender').value;
                const weight = parseFloat($('#calorie-weight').value); // kg
                const height = parseFloat($('#calorie-height').value); // cm
                const activity = $('#calorie-activity').value;
                const goal = $('#calorie-goal').value;
                
                // Calculate BMR (Basal Metabolic Rate) using Mifflin-St Jeor Equation
                let bmr;
                if (gender === 'male') {
                    bmr = 10 * weight + 6.25 * height - 5 * age + 5;
                } else {
                    bmr = 10 * weight + 6.25 * height - 5 * age - 161;
                }
                
                // Apply activity multiplier
                const activityMultipliers = {
                    'sedentary': 1.2,
                    'light': 1.375,
                    'moderate': 1.55,
                    'active': 1.725,
                    'very-active': 1.9
                };
                
                const maintenance = Math.round(bmr * activityMultipliers[activity]);
                
                // Adjust for goal
                let recommended;
                if (goal === 'lose') {
                    recommended = Math.round(maintenance - 500); // 500 calorie deficit
                } else if (goal === 'gain') {
                    recommended = Math.round(maintenance + 500); // 500 calorie surplus
                } else {
                    recommended = maintenance;
                }
                
                // Calculate macros (rough estimate)
                // Protein: 2g per kg for building muscle, 1.6g for maintenance, 2g for cutting
                let proteinPerKg;
                if (goal === 'gain') {
                    proteinPerKg = 2;
                } else if (goal === 'lose') {
                    proteinPerKg = 2;
                } else {
                    proteinPerKg = 1.6;
                }
                
                const proteinGrams = Math.round(weight * proteinPerKg);
                const proteinCalories = proteinGrams * 4;
                
                // Fat: Minimum 20% of calories
                const fatCalories = Math.round(recommended * 0.25);
                const fatGrams = Math.round(fatCalories / 9);
                
                // Remaining calories from carbs
                const carbCalories = recommended - proteinCalories - fatCalories;
                const carbGrams = Math.round(carbCalories / 4);
                
                // Display results
                $('#result-bmr').textContent = `${Math.round(bmr)} calories`;
                $('#result-maintenance').textContent = `${maintenance} calories`;
                $('#result-recommended').textContent = `${recommended} calories`;
                
                $('#result-protein').textContent = `${proteinGrams}g (${Math.round(proteinCalories / recommended * 100)}%)`;
                $('#result-carbs').textContent = `${carbGrams}g (${Math.round(carbCalories / recommended * 100)}%)`;
                $('#result-fat').textContent = `${fatGrams}g (${Math.round(fatCalories / recommended * 100)}%)`;
                
                $('#calorie-results').classList.remove('hidden');
            });
        }
        
        // Initialize AI trainer
        function initAiTrainer() {
            const trainerInput = $('#trainer-input');
            const trainerSendBtn = $('#trainer-send-btn');
            const trainerChat = $('#trainer-chat');
            const quickQuestions = $$('.quick-question');
            
            // AI Trainer chat
            async function sendTrainerMessage(message) {
                // Add user message to chat
                const userMessage = document.createElement('div');
                userMessage.className = 'trainer-message bg-primary bg-opacity-10 dark:bg-opacity-20 text-primary dark:text-primaryLight p-3 rounded-lg shadow-sm mb-3 self-end max-w-[80%]';
                userMessage.innerHTML = `<p>${message}</p>`;
                trainerChat.appendChild(userMessage);
                
                // Add loading indicator
                const loadingMessage = document.createElement('div');
                loadingMessage.className = 'trainer-message bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm mb-3 self-start max-w-[80%] flex items-center';
                loadingMessage.innerHTML = `
                    <div class="inline-block animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-primary mr-2"></div>
                    <p>Thinking...</p>
                `;
                trainerChat.appendChild(loadingMessage);
                
                // Scroll to bottom of chat
                trainerChat.scrollTop = trainerChat.scrollHeight;
                
                try {
                    // Register handler for AI response
                    window.Poe.registerHandler("trainer-handler", (result, context) => {
                        const msg = result.responses[0];
                        
                        if (msg.status === "error") {
                            loadingMessage.innerHTML = `<p class="text-red-500">Error: ${msg.statusText || 'Failed to get response'}</p>`;
                        } else if (msg.status === "incomplete") {
                            // Update with partial content while streaming
                            loadingMessage.innerHTML = marked.parse(msg.content);
                        } else if (msg.status === "complete") {
                            // Update with final content
                            loadingMessage.innerHTML = marked.parse(msg.content);
                            
                            // Scroll to bottom of chat
                            trainerChat.scrollTop = trainerChat.scrollHeight;
                        }
                    });
                    
                    // Get user profile for context
                    const profile = loadUserProfile() || {};
                    
                    // Build the prompt with user profile context if available
                    let prompt = `@Claude-3.7-Sonnet `;
                    
                    // Add profile context if available
                    if (profile.name) {
                        prompt += `Acting as a fitness trainer for ${profile.name}, `;
                        
                        // Add more context if available
                        const contextItems = [];
                        if (profile.age) contextItems.push(`age: ${profile.age}`);
                        if (profile.gender) contextItems.push(`gender: ${profile.gender}`);
                        if (profile.weight) contextItems.push(`weight: ${profile.weight}kg`);
                        if (profile.height) contextItems.push(`height: ${profile.height}cm`);
                        if (profile.fitnessLevel) contextItems.push(`fitness level: ${profile.fitnessLevel}`);
                        if (profile.goal) contextItems.push(`goal: ${profile.goal.replace(/-/g, ' ')}`);
                        
                        if (contextItems.length > 0) {
                            prompt += `who has ${contextItems.join(', ')}, `;
                        }
                    }
                    
                    // Add the actual query
                    prompt += `${message}`;
                    
                    // Send the prompt to Claude
                    await window.Poe.sendUserMessage(prompt, {
                        handler: "trainer-handler",
                        stream: true,
                        openChat: false
                    });
                    
                } catch (error) {
                    loadingMessage.innerHTML = `<p class="text-red-500">Error: ${error.message || 'Failed to send message'}</p>`;
                    
                    // Scroll to bottom of chat
                    trainerChat.scrollTop = trainerChat.scrollHeight;
                }
            }
            
            // Send button
            trainerSendBtn.addEventListener('click', () => {
                const message = trainerInput.value.trim();
                if (message) {
                    sendTrainerMessage(message);
                    trainerInput.value = '';
                }
            });
            
            // Enter key to send
            trainerInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') {
                    const message = trainerInput.value.trim();
                    if (message) {
                        sendTrainerMessage(message);
                        trainerInput.value = '';
                    }
                }
            });
            
            // Quick questions
            quickQuestions.forEach(btn => {
                btn.addEventListener('click', () => {
                    const message = btn.textContent.trim();
                    sendTrainerMessage(message);
                });
            });
        }
        
        // Helper function to capitalize first letter
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            initTabs();
            initModals();
            initUserProfile();
            initWorkoutLibrary();
            initDietForm();
            initCalorieCalculator();
            initAiTrainer();
            updateRecentActivity();
        });
    </script>
</body>
</html>
